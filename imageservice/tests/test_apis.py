""""
To run the test, start the uvicorn server and run the below command
- PYTHONPATH=src python3 src/imageservice/api.py
- PYTHONPATH=src pytest tests/ --debug -s
"""


import json
import requests
import logging

logger = logging.getLogger("test_logger")

userId="3241"
bucket_name=""

message = '"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"'

def test_upload_image():

    url = 'http://localhost:8000/upload?userId=3241'
    headers = {
        'accept': 'application/json',
        'Content-Type': 'application/json',
    }
    response = requests.post(url, headers=headers, data=message)
    assert response.status_code == 200

def test_list_images():

    url = 'http://localhost:8000/list?userId=3241'
    headers = {
        'accept': 'application/json',
        'Content-Type': 'application/json',
    }
    response = requests.get(url, headers=headers)
    assert response.status_code == 200
    assert len(response.content) != 0
    return response.content

def test_view_image():
    content = json.loads(test_list_images())
    url = 'http://localhost:8000/list'
    headers = {
        'accept': 'application/json',
        'Content-Type': 'application/json',
    }
    for time in content.get("thumbnails",[]):
        timestamp = time.get("timestamp")
        response = requests.get(url, headers=headers,params={
            "timestamp" :timestamp,
            "userId": "3241"
        })
        assert response.status_code == 200

def test_delete_image():
    content = json.loads(test_list_images())
    url = 'http://localhost:8000/delete'
    headers = {
        'accept': 'application/json',
        'Content-Type': 'application/json',
    }
    for time in content.get("thumbnails",[]):
        timestamp = time.get("timestamp") 
        response = requests.post(url, headers=headers,params={
            "timestamp" :timestamp,
            "userId": "3241"
        })
        assert response.status_code == 200
